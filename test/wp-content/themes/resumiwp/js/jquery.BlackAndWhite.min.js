!(function(a){a.fn.extend({BlackAndWhite:function(i){var x=this,n={hoverEffect:true,webworkerPath:false,responsive:true,invertHoverEffect:false,speed:500,onImageReady:null,intensity:1};i=a.extend(n,i);var k=i.hoverEffect,f=i.webworkerPath,c=i.invertHoverEffect,h=i.responsive,j=(typeof i.intensity==="number"&&i.intensity<1&&i.intensity>0)?i.intensity:1,B=a.isPlainObject(i.speed)?i.speed.fadeIn:i.speed,s=a.isPlainObject(i.speed)?i.speed.fadeOut:i.speed;var t=(document.all&&!window.opera&&window.XMLHttpRequest)?true:false;var e=" -webkit- -moz- -o- -ms- ".split(" ");var g={};var A=function(E){if(g[E]||g[E]===""){return g[E]+E}var F=document.createElement("div");var D=["","Moz","Webkit","O","ms","Khtml"];for(var C in D){if(typeof F.style[D[C]+E]!=="undefined"){g[E]=D[C];return D[C]+E}}return E.toLowerCase()};var u=function(){var C=document.createElement("div");C.style.cssText=e.join("filter:blur(2px); ");return !!C.style.length&&((document.documentMode===undefined||document.documentMode>9))}();var d=!!document.createElement("canvas").getContext,p=a(window),v=(function(){return(typeof(Worker)!=="undefined")?true:false}()),o=A("Filter"),q=[],y=v&&f?new Worker(f+"BnWWorker.js"):false;var l=function(C){a(C.currentTarget).find(".BWfade").stop(true,true)[!c?"fadeIn":"fadeOut"](s)};var z=function(C){a(C.currentTarget).find(".BWfade").stop(true,true)[c?"fadeIn":"fadeOut"](B)};var w=function(C){if(typeof i.onImageReady==="function"){i.onImageReady(C)}};var m=function(){if(!q.length){if(y.terminate){y.terminate()}if(y.close){y.close()}return}y.postMessage({imgData:q[0].imageData,intensity:j});y.onmessage=function(C){q[0].ctx.putImageData(C.data,0,0);w(q[0].img);q.splice(0,1);m()}};var b=function(J,F,D,M){var N=F.getContext("2d"),H=J,I=0,K;N.drawImage(J,0,0,D,M);var C=N.getImageData(0,0,D,M),L=C.data,E=L.length;if(y){q.push({imageData:C,ctx:N,img:J})}else{for(;I<E;I+=4){var G=L[I]*0.3+L[I+1]*0.59+L[I+2]*0.11;L[I]=~~(G*j+L[I]*(1-j));L[I+1]=~~(G*j+L[I+1]*(1-j));L[I+2]=~~(G*j+L[I+2]*(1-j))}N.putImageData(C,0,0);w(J)}};var r=function(D,G){var I=D[0],C=I.src,E=D.width(),M=D.height(),F=D.position(),H={position:"absolute",top:F.top,left:F.left,display:c?"none":"block"};if(d&&!u){var L=I.width,J=I.height;a('<canvas class="BWfade" width="'+L+'" height="'+J+'"></canvas>').prependTo(G);var K=G.find("canvas");K.css(H);b(I,K[0],L,J)}else{H[A("Filter")]="grayscale("+j*100+"%)";a("<img src="+C+' width="'+E+'" height="'+M+'" class="BWFilter BWfade" /> ').prependTo(G);a(".BWFilter").css(a.extend(H,{filter:"progid:DXImageTransform.Microsoft.BasicImage(grayscale=1)"}));w(I)}};this.init=function(C){x.each(function(E,D){var G=a(D),F=G.find("img");if(!F.width()){F.on("load",function(){r(F,G)})}else{r(F,G)}});if(y){m()}if(k){x.on("mouseleave",l);x.on("mouseenter",z)}if(h){p.on("resize orientationchange",x.resizeImages)}};this.resizeImages=function(){x.each(function(E,G){var D=a(G).find("img:not(.BWFilter)"),C=t?a(D).prop("width"):a(D).width(),F=t?a(D).prop("height"):a(D).height();a(this).find(".BWFilter, canvas").css({width:C,height:F})})};return this.init(i)}})}(jQuery));